open import Relation.Binary.Definitions
open import Relation.Binary.PropositionalEquality
open import GTTM.Quantity

module GTTM.Rules (Var : Set) (_â‰Ÿ_ : DecidableEquality Var) (Quant : Set) (IsQuant : IsQuantity Quant) where
    
    open import GTTM.Syntax Var Quant
    open import GTTM.Context Var Quant IsQuant
    open import GTTM.Substitution Var _â‰Ÿ_ Quant IsQuant 
    open import GTTM.Normalization Var _â‰Ÿ_ Quant IsQuant 
    open import Data.List.Membership.Propositional 

    private
        variable
            x : Var
            Ï : Quant
            s t a b : Term
            p q r : Term
            A B S T R : Type
            Î“ Î“â‚ Î“â‚‚ Î“â‚ƒ Î“â‚„ : Context 
            Î“â‚š Î”â‚š : PreContext 

    open IsQuantity IsQuant using (one; zero)

    data _âŠ¢_âˆ¶_ : Context â†’ Term â†’ Type â†’ Set where
        t-var : 
            (ğŸ˜Î“ : Î“ â‰¡ ğŸ˜ Î“) â†’
            (âŠ¢T : Î“ âŠ¢ T âˆ¶ â‹†) â†’
            ------------------------------
            (Î“ ,[ one â‚˜ ] x âˆ¶ T) âŠ¢ ` x âˆ¶ T

        t-mult-type :
            ------------
            âˆ… âŠ¢ mult âˆ¶ â‹†

        t-type-type : 
            ---------
            âˆ… âŠ¢ â‹† âˆ¶ â‹†  

        t-mult-quant :
            --------------
            âˆ… âŠ¢ Ï â‚˜ âˆ¶ mult
        
        t-mult-+ :
            (âŠ¢p : Î“â‚ âŠ¢ p âˆ¶ mult) â†’
            (âŠ¢q : Î“â‚‚ âŠ¢ q âˆ¶ mult) â†’
            (Î“â‚â‚‚-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚‚ âŒ‹) â†’
            (Î“-split : (Î“â‚ + Î“â‚‚ [ Î“â‚â‚‚-â‰¡ ]) â‰¡ Î“) â†’
            -----------------
            Î“ âŠ¢ p +â‚˜ q âˆ¶ mult

        t-mult-Â· :
            (âŠ¢p : Î“â‚ âŠ¢ p âˆ¶ mult) â†’
            (âŠ¢q : Î“â‚‚ âŠ¢ q âˆ¶ mult) â†’
            (Î“â‚â‚‚-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚‚ âŒ‹) â†’
            (Î“-split : (Î“â‚ + Î“â‚‚ [ Î“â‚â‚‚-â‰¡ ]) â‰¡ Î“) â†’
            -----------------
            Î“ âŠ¢ p Â·â‚˜ q âˆ¶ mult 

        t-lam : 
            (âŠ¢a : (Î“â‚ ,[ p ] x âˆ¶ A) âŠ¢ a âˆ¶ B) â†’
            (âŠ¢p : Î“â‚‚ âŠ¢ p âˆ¶ mult) â†’ 
            (âŠ¢A : Î“â‚ƒ âŠ¢ A âˆ¶ â‹†) â†’
            (âŠ¢B : (Î“â‚„ ,[ r ] x âˆ¶ A) âŠ¢ B âˆ¶ â‹†) â†’
            (Î“â‚â‚‚-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚‚ âŒ‹) â†’
            (Î“â‚â‚ƒ-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚ƒ âŒ‹) â†’
            (Î“â‚â‚ƒ-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚„ âŒ‹) â†’
            --------------------------------------------
            Î“â‚ âŠ¢ (Æ›[ p ] x âˆ¶ A â‡’ a) âˆ¶ (â¦…[ p ] x âˆ¶ A â¦†â‡’ B)

        t-pi :
            (âŠ¢p : Î“â‚ âŠ¢ p âˆ¶ mult) â†’
            (âŠ¢A : Î“â‚‚ âŠ¢ A âˆ¶ â‹†) â†’
            (âŠ¢B : (Î“â‚ƒ ,[ r ] x âˆ¶ A) âŠ¢ B âˆ¶ â‹†) â†’
            (Î“â‚â‚‚-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚‚ âŒ‹) â†’
            (Î“â‚â‚ƒ-â‰¡ : âŒŠ Î“â‚ + Î“â‚‚ [ Î“â‚â‚‚-â‰¡ ] âŒ‹ â‰¡ âŒŠ Î“â‚ƒ âŒ‹) â†’
            (Î“-split : ((Î“â‚ + Î“â‚‚ [ Î“â‚â‚‚-â‰¡ ]) + Î“â‚ƒ [ Î“â‚â‚ƒ-â‰¡ ]) â‰¡ Î“) â†’ 
            ---------------------------- 
            Î“ âŠ¢ (â¦…[ p ] x âˆ¶ A â¦†â‡’ B) âˆ¶ â‹† 
        
        t-app :
            (âŠ¢s : Î“â‚ âŠ¢ s âˆ¶ (â¦…[ p ] x âˆ¶ A â¦†â‡’ B)) â†’
            (âŠ¢t : Î“â‚‚ âŠ¢ t âˆ¶ A) â†’
            (Î“â‚â‚‚-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ p Â· Î“â‚‚ âŒ‹) â†’
            (Î“-split : (Î“â‚ + (p Â· Î“â‚‚) [ Î“â‚â‚‚-â‰¡ ]) â‰¡ Î“) â†’
            (R-conv : R â‰¡ (B [ t / x ])) â†’
            ------------------------------
            Î“ âŠ¢ (s âˆ™ t) âˆ¶ R 
        
        t-sub :
            (âŠ¢a : Î“â‚ âŠ¢ a âˆ¶ A) â†’ 
            (Î“-â‰¤ : Î“â‚ â‰¤ Î“â‚‚) â†’ 
            (Î“â‚â‚‚-â‰¡ : âŒŠ Î“â‚ âŒ‹ â‰¡ âŒŠ Î“â‚‚ âŒ‹) â†’
            ---------------------------
            Î“â‚‚ âŠ¢ a âˆ¶ A 
        
        t-weak :
            (âŠ¢b : Î“â‚ âŠ¢ b âˆ¶ B) â†’
            (âŠ¢A : Î“â‚‚ âŠ¢ A âˆ¶ â‹†) â†’
            (âˆ‰Î“â‚ : x âˆ‰ dom Î“â‚) â†’
            ------------------------------
            (Î“â‚ ,[ zero â‚˜ ] x âˆ¶ A) âŠ¢ b âˆ¶ B

        t-conv :
            (â–¸a : a â–¸ t) â†’
            (â–¸b : b â–¸ t) â†’
            (â–¸A : A â–¸ T) â†’
            (â–¸B : B â–¸ T) â†’
            (âŠ¢a : Î“ âŠ¢ a âˆ¶ A) â†’
            (âŠ¢A : Î“ âŠ¢ A âˆ¶ â‹†) â†’
            -------------------
            Î“ âŠ¢ b âˆ¶ B